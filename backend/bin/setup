#!/usr/bin/env ruby
require "optparse"
require_relative "../lib/dev/tooling"

# Setup script for preparing the development environment
#
# This script ensures your Rails application is ready to run by:
# - Installing/updating Ruby gem dependencies (bundle install)
# - Creating/migrating the database (db:prepare)
# - Setting up any additional application requirements
#
# Run this after cloning the repository or pulling updates that change
# dependencies or database schema. It's safe to run multiple times.
#
# Usage:
#   bin/setup         # Run all setup steps
#   bin/setup --reset # Reset database before preparing
#   bin/setup --help  # Show all available options

APP_ROOT = File.expand_path("..", __dir__)

# Parse command-line arguments
options = { reset: false }

parser = OptionParser.new do |opts|
  opts.banner = "Usage: bin/setup [OPTIONS]"
  opts.separator ""
  opts.separator "Idempotent setup script for the development environment."
  opts.separator ""
  opts.separator "Options:"

  opts.on("--reset", "Reset the database before preparing") do
    options[:reset] = true
  end

  opts.on("-h", "--help", "Show this help message") do
    puts opts
    exit 0
  end
end

parser.parse!(ARGV)

# Run the setup
LinkRadar::Tooling::SetupRunner.new(APP_ROOT).run(reset: options[:reset]) if __FILE__ == $0
